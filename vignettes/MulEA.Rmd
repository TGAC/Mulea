---
title: "MulEA"
author: "Wiktor Jurkowski, Eszter Ari, David Fazekas, Cezary Turek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MulEA}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r global_options, include=TRUE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, error = TRUE)
```

THIS IS VIGNETTE in time of development. :)

Mulea is a package to acheave models of ... from our global DB or give you possibility
to put your own model to your local database. Of course you can push it to global DB.
Then you can use implemented mthods to alalysis data.

Actually implemented features (explained in details ... ) are:

- [Mulea Database Workflow](#mulea-database-workflow)
    - [File](#file)
    - [Local Mulea DB](#local-mulea-db)
    - [Global Mulea DB](#global-mulea-db)
- [Data Analysis](#data-analysis)
    - [Analysis Methods](#analysis-methods)
        - [Contingency Table Base](#contingency-table-base)
            - [Hypergeometric Test](#hypergeometric-test)
            - [Fisher Test](#fisher-test)
            - [Chi Squared Test](#chi-squared-test)
        - [Ranking Base](#ranking-base)
            - [Kolmogorov Smirnov Test](#kolmogorov-smirnov-test)
        - [Graph Base](#graph-base)
    - [Extra Operations](#extra-operations)
        - [Multiple Comparisons Problem](#multiple-comparisons-problem)
- [Code Snippet](#code-snippet)
- [Other](#other)


## Mulea Database Workflow
We have 3 ways of working with data in MulEA package. You can work directly from our global DB, you can work with your local DB or with files. Below you can find detailed instructions.


### File
File which includes model need to be in GMT: Gene Matrix Transposed file format (*.gmt) ([format explanation](http://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#GMT:_Gene_Matrix_Transposed_file_format_.28.2A.gmt.29)). You can find example of that file under MulEA installation directory in example folder. To find installation directory use find.package("MulEA") command.

To read GMT file as dataframe use this methos please: `MulEA::readGmtFileAsDF()`. Method accepts one required (*) argument `gmtFilePath`.

- `gmtFilePath` - It is path to file, which include model. Example: `"R/MulEA/example/model.gmt"`

Model is read into the data frame which looks like that:

```{r, results = 'asis'} 
pathToModelGmtFile <- paste(find.package("MulEA"),"/example/model.gmt", sep = "")
modelDfFromFile <- MulEA::readGmtFileAsDF(gmtFilePath = pathToModelGmtFile)
knitr::kable(modelDfFromFile, caption = "Model Data Frame")
```

You can also save data frame which represents model to GMT file. To do it use `MulEA::saveModelFromDataFrameToGmtFile()`. You have to provide two arguments `modelDF`, `gmtFilePath`.

- `modelDF` - A data frame represents model.
- `gmtFilePath` - Path to file where you want to save model. Example: `"R/MulEA/example/savedModel.gmt"`


### Local Mulea DB
With MulEA you can have all your models (models from files, global DB etc.) in one place. This place is local DB. This open for you an easy way to control, share and work with all your models. Before storing or downloading models thare you need to run database. To do it please use `MulEA::startLocalDatabase()`, this method creates the same schema as on Global DB, but locally on your computer. If schema has been already created it reads database. This method also has one argument:

- `muleaDBLocalization` - By default its value is `":memory:"` which means that DB is created in memory of computer. If you want to have file which represents you database, for example for sharing it, you should put a directory when SQLite file should be created. Example: `"/home/muleaDB/"`. File with name `MulEA.sqlite` will be created there.

To see how database look like please install add-on to Mozilla Firefox https://addons.mozilla.org/en-US/firefox/addon/sqlite-manager/ and then go to url chrome://sqlitemanager/content/sqlitemanager.xul choose from main menu Database > Connect Database, then choose file MulEA.sqlite.

It is good practise to close database connection after you finish work with MulEA. To do it type that command: `MulEA::stopLocalDatabase()`.

If database is running you are ready to add model to it. To do it use `MulEA::addModelToLocalDatabase()`. AddModelToLocalDatabase accepts 7 arguments. Four of them are required (*) `model`, `taxonomy_id`, `model_source`, `version`, and other 3 are optional `scientific_name`, `common_english_name`, `description`.

- `model` - Data Frame with model. For example a Data Frame returned by `MulEA::readGmtFileAsDF()`.
- `taxonomy_id` - It is an integer represents a taxonomy id from NCBI. In case of homo sapiense it is 9001.
- `model_source` -  It is a String. It should represents origin of mode. Gen Ontology can be "GO".
- `version` - Integer represents a version of model. It alows you to have many versions of the same model. It it is secound model of homo sapiense from "GO", then good practice is putting there 2.
- `scientific_name` - It is text, which represents scientific name. It should helps you to faster identify organism.
- `common_english_name` - The same as above.
- `description` - It is a place for your own notes about this specific model.

To list models from you local DB invoke `MulEA::listModelsFromLocalDatabase()` (not implemented yet)

You can remove model from DB by `MulEA::removeModelFromLocalDatabase()`. Arguments of that method are Primary Kay (PK) of organisms_models table.

- `taxonomy_id` - Integer represents a taxonomi id of organism.
- `model_source` - Origin of model.
- `version` - Version of model in DB.

Getting model from DB is achived by two methods; `MulEA::getModelFromLocalDatabaseAsDf` and `MulEA::getModelFromLocalDatabaseAsList`. As name says it can be get from database in two way as data frame or list. Data frame is used with analysis methods provided by MulEA. List representation can be usefull as input to other packages methods. Both of them accept the same arguments, which are required (*) `taxonomy_id`, `model_source`, `version`.

In addition MulEA provides a helper method to save one model from local DB in file in GMT format. `MulEA::saveModelFromLocalDatabaseToFile()` accepts `taxonomy_id`, `model_source`, `version`, `gmtFilePath` all of them are required (*).

- `gmtFilePath` - It is path to gmt file where model from local DB will be saved.


### Global Mulea DB
(Not implemented yet.)


## Data Analysis
"Analysis of data is a process of inspecting, cleansing, transforming, and modeling data with the goal of discovering useful information, suggesting conclusions, and supporting decision-making.", [Wikipedia](https://en.wikipedia.org/wiki/Data_analysis). MulEA makes data analysis on data frames. We implemented for you three types of tests base on contingency tables, rankings and topology of data.


### Analysis Methods


#### Contingency Table Base
Hypothesis tests may be performed on contingency tables. Cells in contingency table are defined as relationships between the row and column variables. MulEA provides few tests which are based on a contingency table. Hypergeometric,  Fisher and Chi Squared tests are documented below.


##### Hypergeometric Test
Hypergeometric test bases on [hypergeometric distribution](https://en.wikipedia.org/wiki/Hypergeometric_distribution). To perform it on some model you should invoke this method `MulEA::calculateHypergeometricTest()` with below parameters:

- `model` - it is place for data frame represents model. Read it from file or load from DBs.
- `sampleVector` - It is a vector of your experimental data. Example: `dataFromExperiment <- c("FBgn0004407", "FBgn0010438", "FBgn0003742")`.
- `adjustMethod = NA` - as you can see, by default is is set to NA. You can specify an algorithm which helps you with [Multiple Comparisons Problem](#multiple-comparisons-problem).

Data frame which you achieve as a results of running of this test looks like that:

```{r, results = 'asis'} 
experimentalData <- c("FBgn0004407", "FBgn0010438", "FBgn0003742", "FBgn0029709", "FBgn0030341", "FBgn0037044", "FBgn0002887")
hypergeometricTest <- MulEA::calculateHypergeometricTest(model = modelDfFromFile, sampleVector = experimentalData)
knitr::kable(hypergeometricTest, caption = "Hypergeometric Test Result Data Frame")
```

Columns names are `category`,	`description`,	`listOfValues`,	`listOfValuesUnderCategory`,	`q`,	`m`,	`n`,	`k`,	`p.value`. First three a are copies from input data frame. `listOfValuesUnderCategory` represents an intersection of list of values under category and experimental data vector. Contingency table in this test is represented by `q`,	`m`,	`n`,	`k`. P-values are in the last column of presented DF. 


##### Fisher Test
[Fisher test](#https://en.wikipedia.org/wiki/Fisher's_exact_test) is represented in MulEA by `MulEA::calculateFisherTest()` method. It takes the same list of arguments as [Hypergeometric Test](#hypergeometric-test), but it procucts different results.

```{r, results = 'asis'} 
fisherTest <- MulEA::calculateFisherTest(model = modelDfFromFile, sampleVector = experimentalData)
knitr::kable(fisherTest, caption = "Fisher Test Result Data Frame")
```

Structure of single cell of test results column is the same as R documentation about  [Fisher's Exact Test](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/fisher.test.html). To get it from data frame you can use similar formula to this `fisherTest[4,]$testResultsColumnName[[1]]`. It takes fourth row of resulted data frame and takes only unlisted cell with test resut, it looks like this: 

```{r, results = 'asis'} 
fisherTest[4,]$testResultsColumnName[[1]]
```


##### Chi Squared Test
The last test from that category is [Chi Squared Test](https://en.wikipedia.org/wiki/Chi-squared_test). To calculate it on the groups from model data frame you have to invoke this method: `MulEA::calculateChiSquaredTest()`. It takes the same list of arguments as two privously presented methods. Result data frame looks like below (We have presented only firs three rows, it is space consuming :)):

```{r, results = 'asis'} 
chiSquaredTest <- MulEA::calculateChiSquaredTest(model = modelDfFromFile, sampleVector = experimentalData)
knitr::kable(head(chiSquaredTest, n = 3), caption = "Chi Squared Test Result Data Frame")
```

Similar formula to this can be used to achive results for specific row of data `chiSquaredTest[2,]$testResultsColumnName[[1]]`. Result cell is in form of result from [Pearson's Chi-squared Test](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/chisq.test.html).

```{r, results = 'asis'} 
chiSquaredTest[4,]$testResultsColumnName[[1]]
```


#### Ranking Base
(not implemented yet)


##### Kolmogorov Smirnov Test
(not implemented yet)


#### Graph Base
(not implemented yet)


### Extra Operations
(not implemented yet)


#### Multiple Comparisons Problem
(not implemented yet)


## Code Snippet
(not implemented yet)


## Other
(not implemented yet)

